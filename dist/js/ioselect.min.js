!function(a,b){"function"==typeof define&&define.amd?define([],b):"object"==typeof exports?module.exports=b():a.ioselect=b()}(this,function(){var a=function(a,b){if(this.listeners=[],this.options={search_min:0},$(a).addClass("ioselect-hidden"),this.element=$(a),this.is_multiple=void 0!==this.element[0].getAttribute("multiple")&&null!=this.element[0].getAttribute("multiple"),this.options={search_min:0,search:!0},void 0!==b)for(var c in b)this.options[c]=b[c];[].slice.call(this.element[0].attributes).filter(function(a){return a&&a.name&&0===a.name.indexOf("data-ioselect-")}).forEach(function(a){this.options[a.name.substr(14).replace(/\-/,"_")]=a.value}.bind(this)),this.options.search_min=parseInt(this.options.search_min),this.options.search=this.options.search&&"0"!==this.options.search,this.element[0].removeAttribute("tabindex");var d=$('<div class="ioselect-container"><div class="ioselect-select ioselect-ns'+(this.multiple?" ioselect-multiple":"")+'"></div><div class="ioselect-dropdown"><div class="ioselect-search"><input tabindex="-1" type="text" class="ioselect-input" autocorrect="off" autocapitalize="off"></div><ul></ul></div>');$(d).insertBefore(a);var e=$(this.element[0].parentNode);this.container=e.find(".ioselect-container")[0],this.dropdown=e.find(".ioselect-dropdown")[0],this.list=e.find(".ioselect-dropdown ul")[0],this.search=e.find(".ioselect-dropdown input[type=text]")[0],this.dropdown_built=this.current_selected=!1,this.select=e.find(".ioselect-select")[0],$(document.body).append(this.dropdown),this.mask=$('<div class="ioselect-mask"></div>')[0],this.filter="",this.mutation_listener=this.SelectMutated.bind(this),this.mutation_observer=!1,"undefined"!=typeof MutationObserver&&(this.mutation_observer=new MutationObserver(this.mutation_listener),this.mutation_observer.observe(this.element[0],{childList:!0,attributes:!0})),this.bind(this.element.closest("form"),"reset",this.Reset.bind(this)),this.bind($(this.dropdown),"click",this.ClickOption.bind(this)),this.bind($(this.select),"click",this.ClickSelect.bind(this)),this.bind(this.element,"change",this.Update.bind(this)),this.search_timeout=null,this.UpdateSelect(),$(this.element).trigger("ready")};return a.prototype={on:function(a,b){var c=function(a){if(void 0!==a.detail&&$.isArray(a.detail.__args)){var c=[a];c.push.apply(c,a.detail.__args),b.apply(null,c)}else b.apply(b,arguments)};this.bind(this.element,a,c)},off:function(a,b){this.unbind(this.element,a,b)},bind:function(a,b,c){this.listeners.push({element:$(a)[0],event:b,func:c}),$(a).on(b,c)},unbind:function(a,b,c){a=$(a)[0];for(var d=[],e=0;e<this.listeners.length;e++){var f=this.listeners[e];void 0!==a&&f.element!=a||void 0!==b&&b!=f.event||void 0!==c&&c!=f.func?d.push(f):$(f.element).off(f.event,f.func)}this.listeners=d},SelectMutated:function(a){for(var b=0;b<a.length;b++)switch(this.HideDropdown(),a[b].type){case"childList":this.Update();break;case"attributes":this.UpdateSelect()}},Resize:function(){this.container.style.width="auto",this.container.style.width=this.container.offsetWidth+"px",this.dropdown.style.width=this.container.offsetWidth+"px",this.SetDropdownPosition()},Reset:function(){setTimeout(function(){this.Update()}.bind(this),0)},ClickSelect:function(a){$(this.container).hasClass("ioselect-disabled")||($(this.container).hasClass("ioselect-open")?this.HideDropdown():this.ShowDropdown())},ShowDropdown:function(a){this.dropdown_built||this.BuildDropdown(),this.current_selected=!1,this.bind(window,"resize",this.Resize.bind(this)),viewportmeta=$('meta[name="viewport"]')[0],this.current_meta=viewportmeta.content.split(",");for(var b=[],c=0;c<this.current_meta.length;c++){""!=this.current_meta[c].split("=")[0]&&b.push(this.current_meta[c])}b.push("user-scalable=NO"),viewportmeta.content=b.join(","),$(document.body).append(this.mask),this.bind(this.mask,"click",this.HideDropdown.bind(this)),this.bind(document.body,"keydown",this.ListenForKeyPress.bind(this)),this.options.search_min>0&&this.element.find("option").length<this.options.search_min||!this.options.search?$(this.search).addClass("ioselect-hidden"):(this.bind(this.search,"input",this.Search.bind(this)),$(this.search).removeClass("ioselect-hidden")),this.scroll_listener_interval=setInterval(this.Scroll.bind(this),10),this.list.scrollTop=0,this.Resize(),$(this.element).trigger("show-dropdown")},SetDropdownPosition:function(){var a=$(this.container).offset();this.current_top=a.top,this.dropdown.style.top=(this.current_top+this.select.offsetHeight).toString()+"px",this.dropdown.style.left=a.left.toString()+"px",$(this.container).addClass("ioselect-open"),$(this.dropdown).addClass("ioselect-open"),this.current_top-document.documentElement.scrollTop+this.dropdown.offsetHeight>Math.max(document.documentElement.clientHeight,window.innerHeight||0)&&(this.dropdown.style.top=a.top+"px",$(this.container).addClass("ioselect-select-up"),$(this.dropdown).addClass("ioselect-drop-up"))},HideDropdown:function(a){clearInterval(this.scroll_listener_interval),this.unbind(window,"resize"),this.container.style.width="auto",!1!==this.current_selected&&($("li:nth-child("+(this.current_selected+1).toString()+")").removeClass("ioselect-current"),this.current_selected=!1),this.current_meta&&($('meta[name="viewport"]')[0].content=this.current_meta.join(",")),$(this.container).hasClass("ioselect-open")&&($(this.container).removeClass("ioselect-open ioselect-select-up"),$(this.dropdown).removeClass("ioselect-open ioselect-drop-up"),null!=this.mask.parentNode&&($(this.mask).remove(),this.unbind(this.mask,"click")),this.filter.length>0&&(this.search.value="",this.filter="",this.dropdown_built=!1),this.unbind(document.body,"keydown"),this.unbind(this.search,"input"),this.ClearSearchTimeout(),$(this.element).trigger("hide-dropdown"))},ListenForKeyPress:function(a){var b=a.keyCode;if(27!=b&&9!=b||this.HideDropdown(),38==b||40==b){if(a.stopPropagation(),a.preventDefault(),40==b)if(!1===this.current_selected)this.current_selected=0;else{if(this.current_selected+1>=this.list.querySelectorAll("li").length)return;$(this.list).find("li:nth-child("+(this.current_selected+1).toString()+")").removeClass("ioselect-current"),this.current_selected++}else{if(!1===this.current_selected||0===this.current_selected)return;$(this.list).find("li:nth-child("+(this.current_selected+1).toString()+")").removeClass("ioselect-current"),this.current_selected--}var c=$(this.list).find("li:nth-child("+(this.current_selected+1).toString()+")")[0];$(c).addClass("ioselect-current"),c.offsetTop-c.parentNode.scrollTop<0?c.parentNode.scrollTop=c.offsetTop:c.offsetTop+c.offsetHeight>this.list.scrollTop+this.list.offsetHeight&&(c.parentNode.scrollTop=c.offsetTop+c.offsetHeight-this.list.offsetHeight)}13==b&&!1!==this.current_selected&&$(this.list).find("li:nth-child("+(this.current_selected+1).toString()+")")[0].click()},ClickOption:function(a){if(a.stopPropagation(),!$(a.target).hasClass("ioselect-selected")&&!$(a.target).hasClass("ioselect-disabled")&&"INPUT"!=a.target.tagName){var b=$(a.target).closest(".ioselect-option,.ioselect-optgroup");if(0!=b.length){if(b.hasClass("ioselect-optgroup"))return void $(this.element).trigger("optgroup-click",[b[0],"asd"]);var c=b[0].getAttribute("data-value");if(this.multiple){if(0==c.length)return;"[object Array]"!==$.isArray(c)&&(c=[c]);for(var d=0;d<c.length;d++)for(var e=this.element.find('option[value="'+c[d].toString()+'"]'),f=0;f<e.length;f++)e[f].selected=!0;$(a.target).addClass("ioselect-selected")}else for(var e=this.element.find('option[value="'+c.toString()+'"]'),f=0;f<e.length;f++)e[f].selected=!0;$(this.element).trigger("change"),this.HideDropdown()}}},RemoveSelectedItem:function(a){a.stopPropagation();var b=Array.prototype.indexOf.call(a.target.parentNode.childNodes,a.target),c=this.element.find("option:checked")[b];c.selected=!1,this.dropdown_built&&$(this.list).find('[data-value="'+c.value+'"]').removeClass("ioselect-selected"),$(this.element).trigger("change")},BuildDropdown:function(){this.ClearSearchTimeout();for(var a=this.element.find("option, optgroup"),b="",c=1,d=0;d<a.length;d++){var e=a[d],f="";if(null!==e.getAttribute("disabled")&&(f=" ioselect-disabled"),"OPTION"==e.nodeName){if(this.filter.length>0&&0!==e.innerText.toLowerCase().indexOf(this.filter.toLowerCase()))continue;var g="";e.selected&&(g=" ioselect-selected"),b+='<li class="ioselect-option ioselect-ns'+f+g+'" data-value="'+e.value+'">'+e.text+"</li>"}else b+='<li class="ioselect-optgroup ioselect-ns'+f+'" data-ioselect-optgroup-index="'+c.toString()+'">'+e.innerText+"</li>",c++}this.list.innerHTML=b,this.dropdown_built=!0,this.list.scrollTop=0},Update:function(){this.dropdown_built=!1,this.UpdateSelect()},UpdateSelect:function(){var a=this.element[0].querySelectorAll("option:checked");if(this.is_multiple){for(var b="",c=0;c<a.length;c++)a[c].hasAttribute("value")&&(b+='<span class="ioselect-selected-item">'+a[c].innerText+"</span>");this.select.innerHTML=b;for(var d=$(this.select).find(".ioselect-selected-item"),c=0;c<d.length;c++)this.bind(d[c],"click",this.RemoveSelectedItem.bind(this))}else{if(0==a.length)var a=this.element.find("option");a.length>0&&(this.select.innerText=a[0].innerText)}this.element[0].disabled&&$(this.container).addClass("ioselect-disabled")},Search:function(){this.filter!=this.search.value&&(null!=this.search_timeout&&this.ClearSearchTimeout(),this.filter=this.search.value,this.search_timeout=setTimeout(function(){this.search_timeout=null,this.BuildDropdown()}.bind(this),200))},ClearSearchTimeout:function(){clearTimeout(this.search_timeout),this.search_timeout=null},Scroll:function(){var a=$(this.container).offset();this.current_top!==a.top&&this.HideDropdown()},Destroy:function(){this.unbind(),this.mutation_observer&&this.mutation_observer.disconnect(),this.container.remove(),this.dropdown.remove(),this.mask.remove(),this.element.removeClass("ioselect-hidden"),$(this.element).trigger("destroyed")}},a}),Element.prototype.matches=Element.prototype.matches||Element.prototype.matchesSelector||Element.prototype.webkitMatchesSelector||Element.prototype.msMatchesSelector||function(a){for(var b=this,c=(b.parentNode||b.document).querySelectorAll(a),d=-1;c[++d]&&c[d]!==b;);return!!c[d]};