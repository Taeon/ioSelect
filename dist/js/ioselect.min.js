!function(a,b){"function"==typeof define&&define.amd?define([],b):"object"==typeof exports?module.exports=b():a.ioselect=b()}(this,function(){if(void 0===a){var a=function(b){var c=function(a){for(var b=q(a),c=0;c<b.length;c++)this[0].appendChild(b[c]);return this},d=function(a){for(var b=q(a),c=b.length-1;c>=0;c--)this[0].insertBefore(b[c],this[0].firstChild);return this},e=function(a){this.each(function(){this.parentNode.removeChild(this)})},f=function(a){for(var b=0;b<this.length;b++)a.apply(this[b])},g=function(b){for(var c=[],d=0;d<this.length;d++)for(var e=this[d];e;)o(e,b)&&(c.push(e),e=!1),e=e.parentNode;return a(c)},h=function(a,b){for(var c=0;c<this.length;c++)this[c].addEventListener(a,b);return this},i=function(a,b){for(var c=0;c<this.length;c++)this[c].removeEventListener(a,b);return this},j=function(a){for(var b=0;b<this.length;b++)this[b].classList?this[b].classList.add(a):this[b].className+=" "+a},k=function(a){a=-1!=a.indexOf(" ")?a.split(" "):[a];for(var b=0;b<a.length;b++){var c=a[b];this.each(function(){this.classList?this.classList.remove(c):this.className=this.className.replace(new RegExp("(^|\\b)"+c.split(" ").join("|")+"(\\b|$)","gi")," ")})}},l=function(a){for(var b=0;b<this.length;b++)if(this[b].classList){if(this[b].classList.contains(a))return!0}else if(new RegExp("(^| )"+a+"( |$)","gi").test(this[b].className))return!0;return!1},m=function(b){for(var c=a(b),d=0;d<c.length;d++){var e=c[d];a(this).each(function(){e.parentNode.insertBefore(this,e)})}return this},n=function(b){for(var c=a(b),d=0;d<c.length;d++){var e=c[d];a(this).each(function(){e.parentNode.insertBefore(this,e.nextSibling)})}return this},o=function(b,c){if(a.isArray(b))for(var d=0;d<b.length;d++)return o(b[d],c);if(c instanceof HTMLElement)return b===c;if(!a.isArray(c))return(b.matches||b.matchesSelector||b.msMatchesSelector||b.mozMatchesSelector||b.webkitMatchesSelector||b.oMatchesSelector).call(b,c);for(var d=0;d<c.length;d++)if(o(b,c))return!0;return this},p=function(a){if("createEvent"in document){var b=document.createEvent("HTMLEvents");b.initEvent(a,!1,!0);for(var c=0;c<this.length;c++)this[c].dispatchEvent(b)}else for(var c=0;c<this.length;c++)this[c].fireEvent(a)};OS=function(){if(0!=this.length){var a=this[0],b=a.getBoundingClientRect(),c=document.body,d=document.documentElement,e=window.pageYOffset||d.scrollTop||c.scrollTop,f=window.pageXOffset||d.scrollLeft||c.scrollLeft,g=d.clientTop||c.clientTop||0,h=d.clientLeft||c.clientLeft||0,i=b.top+e-g,j=b.left+f-h;return{top:Math.round(i),left:Math.round(j)}}};var q=function(b,r){var s;if(b instanceof HTMLElement||b instanceof Window)s=[b];else{switch(Object.prototype.toString.call(b).match(/\[object (.*)\]/)[1]){case"String":if("<"==b.charAt(0)){var t=document.createElement("DIV");t.innerHTML=b,v=t.childNodes}else{var u=!1;if(">"==b.charAt(0)&&(u=!0,b=b.substring(1)),r){if(a.isArray(r))for(var v=[],w=0;w<r.length;w++)for(var x=r[w].querySelectorAll(b),y=0;y<x.length;y++)-1==v.indexOf(x[y])&&v.push.apply(v,r[w].querySelectorAll(b))}else v=document.querySelectorAll(b);if(u){var z=[];r=r||document;for(var w=0;w<v.length;w++)o(r,v[w].parentNode)&&z.push(v[w]);v=z}}break;case"Object":"undefined"!=typeof jQuery&&b instanceof jQuery&&(v=b.toArray());break;case"Array":case"NodeList":v=b;break;case"Function":return void((document.attachEvent?"complete"===document.readyState:"loading"!==document.readyState)?b():document.addEventListener("DOMContentLoaded",b));case"Undefined":v=[];break;default:console.log(b),console.log(Object.prototype.toString.call(b).match(/\[object (.*)\]/)[1])}for(var s=[],w=0;w<v.length;w++)s.push(v[w])}var y={append:c,prepend:d,insertAfter:n,insertBefore:m,on:h,off:i,addClass:j,hasClass:l,removeClass:k,each:f,closest:g,remove:e,trigger:p,offset:OS};for(var A in y)s[A]=function(a,b){return function(){return b.apply(a,arguments)}}.apply(s,[s,y[A]]);return s.find=function(a){return q.apply(s,[a,s])},s};return q(b)};a.proxy=function(a,b){return function(){a.apply(b,arguments)}},a.isArray=function(a){return"Array"==Object.prototype.toString.call(a).match(/\[object (.*)\]/)[1]}}var b=function(b,c){if(this.l=[],a(b).addClass("ioselect-hidden"),this.e=a(b),this.is_multiple=void 0!==this.e[0].getAttribute("multiple")&&null!=this.e[0].getAttribute("multiple"),this.o={search_min:0,search:!0,search_in_text:!1,mobile_breakpoint:768},void 0!==c)for(var d in c)this.o[d]=c[d];[].slice.call(this.e[0].attributes).filter(function(a){return a&&a.name&&0===a.name.indexOf("data-ioselect-")}).forEach(function(a){this.o[a.name.substr(14).replace(/\-/,"_")]=a.value}.bind(this)),this.o.search_min=parseInt(this.o.search_min),this.o.search=this.o.search&&"0"!==this.o.search,this.e[0].removeAttribute("tabindex");var e=a('<div class="ioselect-container"><div class="ioselect-select ioselect-ns'+(this.is_multiple?" ioselect-multiple":"")+'"></div><div class="ioselect-dropdown"><div class="ioselect-search"><input tabindex="-1" type="text" class="ioselect-input" autocorrect="off" autocapitalize="off"></div><div class="ioselect-buttons"><button class="ioselect-button-close">Close</button></div><ul></ul></div>');a(e).insertBefore(b),this.b(e.find(".ioselect-button-close")[0],"click",this.HideDropdown.bind(this));a(this.e[0].parentNode);this.c=a(e)[0],this.d=a(this.c).find(".ioselect-dropdown")[0];var f=this.e[0].getAttribute("data-ioselect-dropdown-class");null!=f&&a(this.d).addClass(f),this.list=a(this.d).find("ul")[0],this.search=a(this.d).find("input[type=text]")[0],this.d_built=this.current_selected=!1,this.select=a(this.c).find(".ioselect-select")[0],a(document.body).append(this.d),this.mask=a('<div class="ioselect-mask"></div>')[0],this.filter="",this.mutation_listener=this.SelectMutated.bind(this),this.mutation_observer=!1,"undefined"!=typeof MutationObserver&&(this.mutation_observer=new MutationObserver(this.mutation_listener),this.mutation_observer.observe(this.e[0],{childList:!0,attributes:!0})),this.b(this.e.closest("form"),"reset",this.Reset.bind(this)),this.b(a(this.d),"click",this.ClickOption.bind(this)),this.b(a(this.select),"click",this.ClickSelect.bind(this)),this.b(this.e,"change",this.Update.bind(this)),this.search_timeout=null,this.UpdateSelect(),a(this.e).trigger("ready")};return b.prototype={on:function(b,c){var d=function(b){if(void 0!==b.detail&&a.isArray(b.detail.__args)){var d=[b];d.push.apply(d,b.detail.__args),c.apply(null,d)}else c.apply(c,arguments)};this.b(this.e,b,d)},off:function(a,b){this.u(this.e,a,b)},b:function(b,c,d){this.l.push({element:a(b)[0],event:c,func:d}),a(b).on(c,d)},u:function(b,c,d){b=a(b)[0];for(var e=[],f=0;f<this.l.length;f++){var g=this.l[f];void 0!==b&&g.element!=b||void 0!==c&&c!=g.event||void 0!==d&&d!=g.func?e.push(g):a(g.element).off(g.event,g.func)}this.l=e},SelectMutated:function(a){for(var b=0;b<a.length;b++)switch(a[b].type){case"childList":this.HideDropdown(),this.Update();break;case"attributes":this.UpdateSelect()}},Resize:function(){this.c.style.width="auto",document.documentElement.clientWidth>=this.o.mobile_breakpoint?(this.d.style.width=this.c.getBoundingClientRect().width+"px",this.is_mobile=!1,a([this.d,this.c,this.mask]).removeClass("ioselect-mobile")):(this.d.style.width="",this.is_mobile=!0,a([this.d,this.c,this.mask]).addClass("ioselect-mobile")),this.SetDropdownPosition()},Reset:function(){setTimeout(function(){this.Update()}.bind(this),0)},ClickSelect:function(b){a(this.c).hasClass("ioselect-disabled")||(a(this.c).hasClass("ioselect-open")?this.HideDropdown():this.ShowDropdown())},ShowDropdown:function(b){this.d_built||this.BuildDropdown(),this.current_selected=!1,this.b(window,"resize",this.Resize.bind(this)),viewportmeta=a('meta[name="viewport"]')[0],this.current_meta=viewportmeta.content.split(",");for(var c=[],d=0;d<this.current_meta.length;d++){""!=this.current_meta[d].split("=")[0]&&c.push(this.current_meta[d])}c.push("user-scalable=NO"),viewportmeta.content=c.join(","),a(document.body).append(this.mask),this.b(this.mask,"click",this.HideDropdown.bind(this)),this.b(document.body,"keydown",this.ListenForKeyPress.bind(this)),this.o.search_min>0&&this.e.find("option").length<this.o.search_min||!this.o.search?a(this.search).closest(".ioselect-search").addClass("ioselect-hidden"):(this.b(this.search,"input",this.Search.bind(this)),a(this.search).closest(".ioselect-search").removeClass("ioselect-hidden")),this.is_mobile||(this.scroll_listener_interval=setInterval(this.Scroll.bind(this),10)),this.list.scrollTop=0,this.Resize(),this.is_mobile||a(this.search).closest(".ioselect-search").hasClass("ioselect-hidden")||this.search.focus(),a(this.e).trigger("show-dropdown")},SetDropdownPosition:function(){if(this.is_mobile)this.d.style.top="",this.d.style.left="";else{var b=a(this.c).offset();this.current_top=b.top,this.d.style.top=(this.current_top+this.select.offsetHeight).toString()+"px",this.d.style.left=b.left.toString()+"px";var c=this.current_top-document.documentElement.scrollTop;a(this.d).addClass("ioselect-open");var d=this.d.offsetHeight;a(this.d).removeClass("ioselect-open");c+d>Math.max(document.documentElement.clientHeight,window.innerHeight||0)&&(this.d.style.top=b.top+"px",a(this.c).addClass("ioselect-select-up"),a(this.d).addClass("ioselect-drop-up"))}a(this.c).addClass("ioselect-open"),a(this.d).addClass("ioselect-open")},HideDropdown:function(b){clearInterval(this.scroll_listener_interval),this.u(window,"resize"),this.c.style.width="auto",!1!==this.current_selected&&(a("li:nth-child("+(this.current_selected+1).toString()+")").removeClass("ioselect-current"),this.current_selected=!1),this.current_meta&&(a('meta[name="viewport"]')[0].content=this.current_meta.join(",")),a(this.c).hasClass("ioselect-open")&&(a(this.c).removeClass("ioselect-open ioselect-select-up"),a(this.d).removeClass("ioselect-open ioselect-drop-up"),null!=this.mask.parentNode&&(a(this.mask).remove(),this.u(this.mask,"click")),this.filter.length>0&&(this.search.value="",this.filter="",this.d_built=!1),this.u(document.body,"keydown"),this.u(this.search,"input"),this.ClearSearchTimeout(),a(this.e).trigger("hide-dropdown"))},ListenForKeyPress:function(b){var c=b.keyCode;if(27!=c&&9!=c||this.HideDropdown(),38==c||40==c){if(b.stopPropagation(),b.preventDefault(),40==c)if(!1===this.current_selected)this.current_selected=0;else{if(this.current_selected+1>=this.list.querySelectorAll("li").length)return;a(this.list).find("li:nth-child("+(this.current_selected+1).toString()+")").removeClass("ioselect-current"),this.current_selected++}else{if(!1===this.current_selected||0===this.current_selected)return;a(this.list).find("li:nth-child("+(this.current_selected+1).toString()+")").removeClass("ioselect-current"),this.current_selected--}var d=a(this.list).find("li:nth-child("+(this.current_selected+1).toString()+")")[0];a(d).addClass("ioselect-current"),d.offsetTop-d.parentNode.scrollTop<0?d.parentNode.scrollTop=d.offsetTop:d.offsetTop+d.offsetHeight>this.list.scrollTop+this.list.offsetHeight&&(d.parentNode.scrollTop=d.offsetTop+d.offsetHeight-this.list.offsetHeight)}13==c&&!1!==this.current_selected&&a(this.list).find("li:nth-child("+(this.current_selected+1).toString()+")")[0].click()},ClickOption:function(b){if(b.stopPropagation(),!(!this.is_multiple&&a(b.target).hasClass("ioselect-selected")||a(b.target).hasClass("ioselect-disabled")||"INPUT"==b.target.tagName)){var c=a(b.target).closest(".ioselect-option,.ioselect-optgroup");if(0!=c.length){if(c.hasClass("ioselect-optgroup"))return void a(this.e).trigger("optgroup-click",[c[0],"asd"]);var d=c[0].getAttribute("data-value");if(this.is_multiple){if(0==d.length)return;"[object Array]"!==a.isArray(d)&&(d=[d]);for(var e=0;e<d.length;e++)for(var f=this.e.find('option[value="'+d[e].toString()+'"]'),g=0;g<f.length;g++)f[g].selected?(f[g].selected=!1,a(b.target).removeClass("ioselect-selected")):(f[g].selected=!0,a(b.target).addClass("ioselect-selected"))}else{var f=this.e.find('option[value="'+d.toString()+'"]');a(this.d).find(".ioselect-selected").removeClass("ioselect-selected");for(var g=0;g<f.length;g++)f[g].selected=!0,a(b.target).addClass("ioselect-selected")}this.is_mobile||this.HideDropdown(),a(this.e).trigger("change")}}},RemoveSelectedItem:function(b){b.stopPropagation();var c=Array.prototype.indexOf.call(b.target.parentNode.childNodes,b.target),d=this.e.find("option:checked")[c];d.selected=!1,this.d_built&&a(this.list).find('[data-value="'+d.value+'"]').removeClass("ioselect-selected"),a(this.e).trigger("change")},BuildDropdown:function(){this.ClearSearchTimeout();for(var a=this.e.find("option, optgroup"),b="",c=1,d=0;d<a.length;d++){var e=a[d],f="";if(null!==e.getAttribute("disabled")&&(f=" ioselect-disabled"),"OPTION"==e.nodeName){if(this.is_multiple&&""==e.value.trim())continue;if(this.filter.length>0&&!this.ApplySearchFilter(e.innerText))continue;var g="";e.selected&&(g=" ioselect-selected"),b+='<li class="ioselect-option ioselect-ns'+f+g+'" data-value="'+e.value+'">'+(""!=e.text?e.text:"&nbsp;")+"</li>"}else b+='<li class="ioselect-optgroup ioselect-ns'+f+'" data-ioselect-optgroup-index="'+c.toString()+'">'+e.innerText+"</li>",c++}this.list.innerHTML=b,this.d_built=!0,this.list.scrollTop=0},GetDropdown:function(){return this.d},ApplySearchFilter:function(a){return this.o.search_in_text?-1!==a.toLowerCase().indexOf(this.filter.toLowerCase()):0===a.toLowerCase().indexOf(this.filter.toLowerCase())},Update:function(){this.d_built=!1,this.UpdateSelect()},UpdateSelect:function(){var b=this.e[0].querySelectorAll("option:checked");if(a(this.select).removeClass("ioselect-placeholder"),this.is_multiple)if(b.length>0){for(var c="",d=0;d<b.length;d++)b[d].hasAttribute("value")&&""!=b[d].getAttribute("value").trim()&&(c+='<span class="ioselect-selected-item">'+(""!=b[d].innerText?b[d].innerText:"&nbsp;")+"</span>");this.select.innerHTML=c;for(var e=a(this.select).find(".ioselect-selected-item"),d=0;d<e.length;d++)this.b(e[d],"click",this.RemoveSelectedItem.bind(this))}else this.e[0].getAttribute("placeholder")&&(this.select.innerText=this.e[0].getAttribute("placeholder"),a(this.select).addClass("ioselect-placeholder"));else{var f="";if(0==b.length)var b=this.e.find("option");if(b.length>0)var f=b[0].innerText;""==f&&(f="&nbsp;",this.e[0].getAttribute("placeholder")&&(f=this.e[0].getAttribute("placeholder"),a(this.select).addClass("ioselect-placeholder"))),this.select.innerHTML=f}this.e[0].disabled?(a(this.c).addClass("ioselect-disabled"),this.HideDropdown()):a(this.c).removeClass("ioselect-disabled")},Search:function(){this.filter!=this.search.value&&(null!=this.search_timeout&&this.ClearSearchTimeout(),this.filter=this.search.value,this.search_timeout=setTimeout(function(){this.search_timeout=null,this.BuildDropdown()}.bind(this),200))},ClearSearchTimeout:function(){clearTimeout(this.search_timeout),this.search_timeout=null},Scroll:function(){if(!this.is_mobile){var b=a(this.c).offset();this.current_top!==b.top&&this.HideDropdown()}},Destroy:function(){this.u(),this.mutation_observer&&this.mutation_observer.disconnect(),this.c.remove(),this.d.remove(),this.mask.remove(),this.e.removeClass("ioselect-hidden"),a(this.e).trigger("destroyed")}},b}),Element.prototype.matches=Element.prototype.matches||Element.prototype.matchesSelector||Element.prototype.webkitMatchesSelector||Element.prototype.msMatchesSelector||function(a){for(var b=this,c=(b.parentNode||b.document).querySelectorAll(a),d=-1;c[++d]&&c[d]!==b;);return!!c[d]};